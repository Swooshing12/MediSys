<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MediSys.ViewModels"
             x:Class="MediSys.Views.Dashboard.CambiarPasswordPage"
             x:DataType="viewmodels:CambiarPasswordViewModel"
             Title="Cambiar Contraseña"
             BackgroundColor="#F8FAFC">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- COLORES DE SEGURIDAD -->
            <Color x:Key="SecurityBlue">#2563EB</Color>
            <Color x:Key="DangerRed">#DC2626</Color>
            <Color x:Key="SuccessGreen">#059669</Color>
            <Color x:Key="WarningAmber">#D97706</Color>
            <Color x:Key="CardWhite">#FFFFFF</Color>
            <Color x:Key="TextDark">#1F2937</Color>
            <Color x:Key="TextMedium">#6B7280</Color>
            <Color x:Key="BackgroundPale">#F9FAFB</Color>
            <Color x:Key="BorderSoft">#E5E7EB</Color>

            <!-- ESTILOS DE SEGURIDAD -->
            <Style x:Key="SecurityCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource CardWhite}" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="Margin" Value="16,8" />
                <Setter Property="BorderColor" Value="{StaticResource BorderSoft}" />
            </Style>

            <Style x:Key="SecurityTitleStyle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource SecurityBlue}" />
                <Setter Property="Margin" Value="0,0,0,16" />
            </Style>

            <Style x:Key="PasswordEntryStyle" TargetType="Entry">
                <Setter Property="BackgroundColor" Value="{StaticResource BackgroundPale}" />
                <Setter Property="TextColor" Value="{StaticResource TextDark}" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="HeightRequest" Value="48" />
                <Setter Property="IsPassword" Value="True" />
            </Style>

            <Style x:Key="SecurityButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource SecurityBlue}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="HeightRequest" Value="50" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="0,0,0,20">

            <!-- HEADER DE SEGURIDAD -->
            <Frame BackgroundColor="{StaticResource SecurityBlue}"
                    HasShadow="True" 
                       Padding="20,16,20,16"
                       Margin="18,12,18,12"
                       CornerRadius="12"
                       HorizontalOptions="FillAndExpand">
                <StackLayout Spacing="12">
                    <Label Text="🔐 Cambiar Contraseña" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center" />
                    <Label Text="Actualiza tu contraseña de forma segura" 
                           FontSize="13" 
                           TextColor="#DBEAFE"
                           HorizontalOptions="Center" />
                </StackLayout>
            </Frame>

            <!-- INFORMACIÓN DE SEGURIDAD -->
            <Frame Style="{StaticResource SecurityCardStyle}">
                <StackLayout Spacing="16">
                    <Label Text="📋 Requisitos de Seguridad" 
                           Style="{StaticResource SecurityTitleStyle}" />

                    <Frame BackgroundColor="#EBF8FF" 
                           CornerRadius="12" 
                           HasShadow="False" 
                           Padding="16">
                        <StackLayout Spacing="8">
                            <Label Text="Tu nueva contraseña debe cumplir:" 
                                   FontSize="14" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource SecurityBlue}" />

                            <StackLayout Spacing="4">
                                <Label Text="✓ Mínimo 8 caracteres" 
                                       FontSize="13" 
                                       TextColor="{StaticResource TextDark}" />
                                <Label Text="✓ Al menos 1 letra mayúscula" 
                                       FontSize="13" 
                                       TextColor="{StaticResource TextDark}" />
                                <Label Text="✓ Al menos 1 letra minúscula" 
                                       FontSize="13" 
                                       TextColor="{StaticResource TextDark}" />
                                <Label Text="✓ Al menos 1 carácter especial (!@#$%^*)" 
                                       FontSize="13" 
                                       TextColor="{StaticResource TextDark}" />
                                <Label Text="✓ Diferente a tu contraseña actual" 
                                       FontSize="13" 
                                       TextColor="{StaticResource TextDark}" />
                            </StackLayout>
                        </StackLayout>
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- FORMULARIO DE CAMBIO -->
            <Frame Style="{StaticResource SecurityCardStyle}">
                <StackLayout Spacing="20">

                    <Label Text="🔑 Actualizar Credenciales" 
                           Style="{StaticResource SecurityTitleStyle}" />

                    <!-- Contraseña actual -->
                    <StackLayout Spacing="8">
                        <Label Text="Contraseña Actual" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextDark}" />

                        <Frame BackgroundColor="{StaticResource BackgroundPale}" 
                               CornerRadius="12" 
                               HasShadow="False" 
                               Padding="12">
                            <Entry Text="{Binding PasswordActual}" 
                                   Placeholder="Ingresa tu contraseña actual"
                                   Style="{StaticResource PasswordEntryStyle}"
                                   BackgroundColor="Transparent" />
                        </Frame>
                    </StackLayout>

                    <!-- Nueva contraseña -->
                    <StackLayout Spacing="8">
                        <Label Text="Nueva Contraseña" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextDark}" />

                        <Frame BackgroundColor="{StaticResource BackgroundPale}" 
                               CornerRadius="12" 
                               HasShadow="False" 
                               Padding="12">
                            <Entry Text="{Binding PasswordNueva}" 
                                   Placeholder="Ingresa tu nueva contraseña"
                                   Style="{StaticResource PasswordEntryStyle}"
                                   BackgroundColor="Transparent"
                                   TextChanged="OnPasswordNuevaChanged" />
                        </Frame>

                        <!-- Validación visual en tiempo real -->
                        <StackLayout Spacing="4" IsVisible="{Binding ShowValidaciones}">
                            <Label Text="{Binding ValidacionLongitud}" 
                                   FontSize="11" 
                                   TextColor="{Binding ColorValidacionLongitud}" />
                            <Label Text="{Binding ValidacionMayuscula}" 
                                   FontSize="11" 
                                   TextColor="{Binding ColorValidacionMayuscula}" />
                            <Label Text="{Binding ValidacionMinuscula}" 
                                   FontSize="11" 
                                   TextColor="{Binding ColorValidacionMinuscula}" />
                            <Label Text="{Binding ValidacionCaracterEspecial}" 
                                   FontSize="11" 
                                   TextColor="{Binding ColorValidacionCaracterEspecial}" />
                        </StackLayout>
                    </StackLayout>

                    <!-- Confirmar contraseña -->
                    <StackLayout Spacing="8">
                        <Label Text="Confirmar Nueva Contraseña" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextDark}" />

                        <Frame BackgroundColor="{StaticResource BackgroundPale}" 
                               CornerRadius="12" 
                               HasShadow="False" 
                               Padding="12">
                            <Entry Text="{Binding ConfirmarPassword}" 
                                   Placeholder="Confirma tu nueva contraseña"
                                   Style="{StaticResource PasswordEntryStyle}"
                                   BackgroundColor="Transparent"
                                   TextChanged="OnConfirmarPasswordChanged" />
                        </Frame>

                        <!-- Validación de coincidencia -->
                        <Label Text="{Binding ValidacionCoincidencia}" 
                               FontSize="11" 
                               TextColor="{Binding ColorValidacionCoincidencia}"
                               IsVisible="{Binding ShowValidacionCoincidencia}" />
                    </StackLayout>

                    <!-- Indicador de seguridad -->
                    <Frame BackgroundColor="{Binding ColorSeguridadPassword}" 
                           CornerRadius="8" 
                           HasShadow="False" 
                           Padding="12"
                           IsVisible="{Binding ShowIndicadorSeguridad}">
                        <Label Text="{Binding NivelSeguridadPassword}" 
                               FontSize="12" 
                               FontAttributes="Bold"
                               TextColor="White"
                               HorizontalOptions="Center" />
                    </Frame>

                    <!-- Botones -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                        <Button Grid.Column="0"
                                Text="Cancelar"
                                BackgroundColor="{StaticResource TextMedium}"
                                TextColor="White"
                                CornerRadius="12"
                                HeightRequest="50"
                                Command="{Binding CancelarCommand}" />

                        <Button Grid.Column="1"
                                Text="Actualizar Contraseña"
                                Command="{Binding CambiarPasswordCommand}"
                                IsEnabled="{Binding PuedeCambiarPassword}"
                                Style="{StaticResource SecurityButtonStyle}" />
                    </Grid>

                    <!-- Indicador de carga -->
                    <StackLayout IsVisible="{Binding IsLoading}" 
                                 Orientation="Horizontal" 
                                 HorizontalOptions="Center"
                                 Spacing="12">
                        <ActivityIndicator IsRunning="{Binding IsLoading}"
                                           Color="{StaticResource SecurityBlue}" />
                        <Label Text="Actualizando contraseña..."
                               FontSize="14"
                               TextColor="{StaticResource TextMedium}" />
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- ADVERTENCIA DE SEGURIDAD -->
            <Frame BackgroundColor="#FEF2F2" 
                   CornerRadius="12" 
                   HasShadow="False" 
                   Padding="16"
                   Margin="16,0">
                <StackLayout Spacing="8">
                    <StackLayout Orientation="Horizontal" Spacing="8">
                        <Label Text="⚠️" FontSize="16" />
                        <Label Text="Importante" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource DangerRed}" />
                    </StackLayout>
                    <Label Text="Después de cambiar tu contraseña, tu sesión se cerrará automáticamente y deberás iniciar sesión nuevamente con la nueva contraseña." 
                           FontSize="12" 
                           TextColor="{StaticResource TextDark}"
                           LineBreakMode="WordWrap" />
                </StackLayout>
            </Frame>

        </StackLayout>
    </ScrollView>
</ContentPage>