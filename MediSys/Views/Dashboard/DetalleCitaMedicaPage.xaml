<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MediSys.ViewModels"
             xmlns:local2="clr-namespace:MediSys.Converters"
             x:Class="MediSys.Views.Dashboard.DetalleCitaMedicaPage"
             x:DataType="viewmodels:DetalleCitaMedicaViewModel"
             Title="Detalle de Cita"
             BackgroundColor="#F0F4F8">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- CONVERTERS -->
            <local2:ObjectToBoolConverter x:Key="ObjectToBoolConverter" />

            <!-- COLORES -->
            <Color x:Key="PrimaryBlue">#1E3A8A</Color>
            <Color x:Key="AccentBlue">#3B82F6</Color>
            <Color x:Key="SuccessGreen">#059669</Color>
            <Color x:Key="DangerRed">#DC2626</Color>
            <Color x:Key="CardBackground">#FFFFFF</Color>
            <Color x:Key="TextPrimary">#1F2937</Color>
            <Color x:Key="TextSecondary">#6B7280</Color>

            <!-- ESTILOS -->
            <Style x:Key="CardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource CardBackground}" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="Margin" Value="0,10" />
            </Style>

            <Style x:Key="TitleStyle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource PrimaryBlue}" />
            </Style>

            <Style x:Key="ButtonStyle" TargetType="Button">
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="45" />
                <Setter Property="HorizontalOptions"  />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView Padding="20">
        <StackLayout Spacing="20">

            <!-- INFORMACIÓN DEL PACIENTE -->
            <Frame Style="{StaticResource CardStyle}">
                <StackLayout Spacing="12">
                                        <Label Text="👤 Información del Paciente" 
                           Style="{StaticResource TitleStyle}" />

                                        <Label Text="{Binding Cita.Paciente.NombreCompleto}" 
                           FontSize="16" FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}" />

                                        <Label Text="{Binding Cita.Paciente.Cedula, StringFormat='📄 Cédula: {0}'}" 
                           TextColor="{StaticResource TextSecondary}" />

                                        <Label Text="{Binding Cita.Paciente.Telefono, StringFormat='📞 Teléfono: {0}'}" 
                           TextColor="{StaticResource TextSecondary}" />

                                        <Label Text="{Binding Cita.Paciente.Correo, StringFormat='📧 Email: {0}'}"
                           TextColor="{StaticResource TextSecondary}" />

                                        <Label Text="{Binding Cita.Paciente.Nacionalidad, StringFormat='🌍 Nacionalidad: {0}'}"
                           TextColor="{StaticResource TextSecondary}" />

                                        <Label Text="{Binding Cita.Paciente.SexoDisplay, StringFormat='⚧ Sexo: {0}'}"
                           TextColor="{StaticResource TextSecondary}" />

                </StackLayout>
            </Frame>

            <!-- INFORMACIÓN DE LA CITA -->
            <Frame Style="{StaticResource CardStyle}">
                <StackLayout Spacing="12">
                    <Label Text="📅 Información de la Cita" 
                           Style="{StaticResource TitleStyle}" />

                    <Label Text="{Binding Cita.FechaDisplay, StringFormat='📅 {0}'}" 
                           FontSize="16" FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}" />

                    <Label Text="{Binding Cita.HoraDisplay, StringFormat='⏰ Hora: {0}'}" 
                           FontSize="16" FontAttributes="Bold"
                           TextColor="{StaticResource AccentBlue}" />

                    <Label Text="{Binding Cita.Motivo, StringFormat='📝 Motivo: {0}'}" 
                           TextColor="{StaticResource TextSecondary}" />

                    <Label Text="{Binding Cita.Estado, StringFormat='📊 Estado: {0}'}" 
                           TextColor="{Binding Cita.EstadoColor}" 
                           FontAttributes="Bold" />

                    <Label Text="{Binding Cita.Sucursal, StringFormat='🏥 Sucursal: {0}'}" 
                           TextColor="{StaticResource TextSecondary}" />

                    <Label Text="{Binding Cita.TipoCita, StringFormat='💻 Tipo: {0}'}" 
                           TextColor="{StaticResource TextSecondary}" />
                </StackLayout>
            </Frame>

            <!-- INFORMACIÓN DE TRIAJE -->
            <Frame IsVisible="{Binding TieneTriaje}"
       BackgroundColor="#F0F9FF" 
       BorderColor="{StaticResource AccentBlue}"
       HasShadow="True" 
       CornerRadius="16" 
       Padding="20"
       Margin="0,10">
                <StackLayout Spacing="12">
                    <Label Text="📊 Datos de Triaje" 
               FontSize="18" FontAttributes="Bold" 
               TextColor="{StaticResource AccentBlue}" />

                    <!-- Signos Vitales -->
                    <StackLayout IsVisible="{Binding TieneSignosVitales}">
                        <Label Text="🔍 Signos Vitales" 
                   FontSize="14" FontAttributes="Bold" 
                   TextColor="{StaticResource TextPrimary}" />

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="8">
                            <Label Grid.Row="0" Grid.Column="0" 
                       Text="{Binding Cita.Triaje.PresionArterial, StringFormat='🩸 Presión: {0}'}" 
                       FontSize="13" />
                            <Label Grid.Row="0" Grid.Column="1" 
                       Text="{Binding Cita.Triaje.Temperatura, StringFormat='🌡️ Temp: {0}°C'}" 
                       FontSize="13" />
                            <Label Grid.Row="1" Grid.Column="0" 
                       Text="{Binding Cita.Triaje.FrecuenciaCardiaca, StringFormat='💓 FC: {0} bpm'}" 
                       FontSize="13" />
                            <Label Grid.Row="1" Grid.Column="1" 
                       Text="{Binding Cita.Triaje.SaturacionOxigeno, StringFormat='🫁 SatO2: {0}%'}" 
                       FontSize="13" />
                            <Label Grid.Row="2" Grid.Column="0" 
                       Text="{Binding Cita.Triaje.Peso, StringFormat='⚖️ Peso: {0} kg'}" 
                       FontSize="13" />
                            <Label Grid.Row="2" Grid.Column="1" 
                       Text="{Binding Cita.Triaje.Talla, StringFormat='📏 Talla: {0} cm'}" 
                       FontSize="13" />
                        </Grid>
                    </StackLayout>

                    <!-- Nivel de Urgencia -->
                    <Frame IsVisible="{Binding EsUrgente}"
               BackgroundColor="#FEE2E2"
               BorderColor="{StaticResource DangerRed}"
               CornerRadius="8"
               Padding="12"
               Margin="0,8,0,0">
                        <Label Text="{Binding Cita.Triaje.NivelUrgencia, StringFormat='🚨 URGENTE - Nivel {0}'}" 
                   TextColor="{StaticResource DangerRed}" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center" />
                    </Frame>

                    <!-- Observaciones -->
                    <Label IsVisible="{Binding TieneObservaciones}"
               Text="{Binding Cita.Triaje.Observaciones, StringFormat='📝 Observaciones: {0}'}" 
               FontSize="13"
               TextColor="{StaticResource TextSecondary}" />
                </StackLayout>
            </Frame>


            <!-- CONSULTA MÉDICA (si existe) -->
            <Frame IsVisible="{Binding Cita.TieneConsulta}"
                   BackgroundColor="#F0FDF4"
                   BorderColor="{StaticResource SuccessGreen}"
                   HasShadow="True" 
                   CornerRadius="16" 
                   Padding="20"
                   Margin="0,10">
                <StackLayout Spacing="10">
                    <Label Text="✅ Consulta Médica Completada" 
                           FontSize="18" FontAttributes="Bold" 
                           TextColor="{StaticResource SuccessGreen}"
                           HorizontalOptions="Center" />

                    <Label Text="Esta cita ya tiene una consulta médica registrada." 
                           FontSize="14"
                           TextColor="{StaticResource TextSecondary}"
                           HorizontalTextAlignment="Center" />
                </StackLayout>
            </Frame>

            <!-- BOTONES DE ACCIÓN -->
            <StackLayout Spacing="12" Margin="0,20,0,0">

                <!-- Botón Iniciar Consulta -->
                <Button Text="🩺 Iniciar Consulta Médica" 
                        Command="{Binding IniciarConsultaCommand}"
                        IsVisible="{Binding Cita.PuedeConsultar}"
                        BackgroundColor="{StaticResource SuccessGreen}" 
                        TextColor="White" 
                        Style="{StaticResource ButtonStyle}" />

                <!-- Botón Ver/Editar Consulta -->
                <Button Text="📋 Ver Consulta Médica" 
                        Command="{Binding VerConsultaCommand}"
                        IsVisible="{Binding Cita.TieneConsulta}"
                        BackgroundColor="{StaticResource AccentBlue}" 
                        TextColor="White" 
                        Style="{StaticResource ButtonStyle}" />

                <!-- Botón Cerrar -->
                <Button Text="❌ Cerrar" 
                        Command="{Binding CerrarModalCommand}"
                        BackgroundColor="{StaticResource TextSecondary}" 
                        TextColor="White" 
                        Style="{StaticResource ButtonStyle}" />
            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>