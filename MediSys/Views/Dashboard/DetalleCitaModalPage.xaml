<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MediSys.ViewModels"
             x:Class="MediSys.Views.Dashboard.DetalleCitaModalPage"
             x:DataType="viewmodels:DetalleCitaViewModel"
             xmlns:local2="clr-namespace:MediSys.Converters"
             Title="Expediente Médico"
             BackgroundColor="#F1F5F9">

    <ContentPage.Resources>
        <ResourceDictionary>

            <local2:BoolToTextConverter x:Key="BoolToTextConverter" />
            <local2:IsNotNullConverter x:Key="IsNotNullConverter" />
            <local2:BoolToColorConverter x:Key="BoolToColorConverter" />
            <!-- COLORES MÉDICOS PREMIUM -->
            <Color x:Key="MedicalBlue">#0EA5E9</Color>
            <Color x:Key="MedicalGreen">#059669</Color>
            <Color x:Key="MedicalRed">#DC2626</Color>
            <Color x:Key="MedicalOrange">#EA580C</Color>
            <Color x:Key="MedicalPurple">#7C3AED</Color>
            <Color x:Key="MedicalTeal">#0D9488</Color>
            <Color x:Key="CardWhite">#FFFFFF</Color>
            <Color x:Key="TextDark">#0F172A</Color>
            <Color x:Key="TextMedium">#475569</Color>
            <Color x:Key="TextLight">#94A3B8</Color>
            <Color x:Key="BackgroundSoft">#F8FAFC</Color>
            <Color x:Key="BorderLight">#E2E8F0</Color>

            <!-- GRADIENTE COMPACTO -->
            <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0EA5E9" Offset="0.0" />
                <GradientStop Color="#0284C7" Offset="1.0" />
            </LinearGradientBrush>

            <!-- ESTILOS ULTRA COMPACTOS -->
            <Style x:Key="MedicalCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource CardWhite}" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="Padding" Value="12" />
                <Setter Property="Margin" Value="8,4" />
                <Setter Property="BorderColor" Value="{StaticResource BorderLight}" />
            </Style>

            <Style x:Key="SectionTitleStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource MedicalBlue}" />
                <Setter Property="Margin" Value="0,0,0,6" />
            </Style>

            <Style x:Key="DataLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="10" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextMedium}" />
                <Setter Property="Margin" Value="0,0,0,2" />
            </Style>

            <Style x:Key="DataValueStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextDark}" />
            </Style>

            <Style x:Key="ActionButtonStyle" TargetType="Button">
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="HeightRequest" Value="36" />
                <Setter Property="Padding" Value="8,0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="0,0,0,16">

            <!-- HEADER COMPACTO -->
            <Frame Background="{StaticResource HeaderGradient}" 
                   HasShadow="True" 
                   Padding="20,16,20,16"
                   Margin="18,12,18,12"
                   CornerRadius="12"
                   HorizontalOptions="FillAndExpand">   

                <!-- Título compacto -->
                <StackLayout Orientation="Horizontal" 
                             HorizontalOptions="Center"
                             Spacing="8">
                    <Label Text="📋" FontSize="18" VerticalOptions="Center" />
                    <Label Text="Expediente Digital" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           TextColor="White"
                           VerticalOptions="Center" />
                </StackLayout>
            </Frame>

            <!-- INFO CITA COMPACTA -->
            <Frame Style="{StaticResource MedicalCardStyle}">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                    <StackLayout Grid.Column="0" Spacing="4">
                        <StackLayout Orientation="Horizontal" Spacing="6">
                            <Label Text="🗓️" FontSize="14" />
                            <Label Text="{Binding Cita.FechaHora, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                   FontSize="12" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource MedicalBlue}" />
                        </StackLayout>
                    </StackLayout>
                    
                    <Frame Grid.Column="1"
                           BackgroundColor="{Binding Cita.EstadoColor}" 
                           CornerRadius="12" 
                           Padding="8,4"
                           HasShadow="False">
                        <Label Text="{Binding Cita.Estado}" 
                               FontSize="10" 
                               FontAttributes="Bold" 
                               TextColor="White" />
                    </Frame>
                </Grid>
            </Frame>

            <!-- MÉDICO COMPACTO -->
            <Frame Style="{StaticResource MedicalCardStyle}">
                <StackLayout Spacing="8">
                    <StackLayout Orientation="Horizontal" Spacing="6">
                        <Label Text="👨‍⚕️" FontSize="16" VerticalOptions="Center" />
                        <Label Text="Médico Tratante" 
                               Style="{StaticResource SectionTitleStyle}"
                               VerticalOptions="Center" />
                    </StackLayout>

                    <StackLayout Spacing="6">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="🩺" FontSize="14" />
                            <Label Text="{Binding Cita.DoctorCompleto}" 
                                   FontSize="13" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextDark}" />
                        </StackLayout>

                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="🏥" FontSize="12" />
                            <Label Text="{Binding Cita.EspecialidadNombre}" 
                                   FontSize="11" 
                                   TextColor="{StaticResource MedicalBlue}" />
                        </StackLayout>

                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="📍" FontSize="12" />
                            <Label Text="{Binding Cita.SucursalNombre}" 
                                   FontSize="11" 
                                   TextColor="{StaticResource TextMedium}" />
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- MOTIVO COMPACTO -->
            <Frame Style="{StaticResource MedicalCardStyle}"
                   IsVisible="{Binding Cita.MotivoConsulta, Converter={StaticResource IsNotNullConverter}}">
                <StackLayout Spacing="6">
                    <StackLayout Orientation="Horizontal" Spacing="6">
                        <Label Text="📝" FontSize="16" />
                        <Label Text="Motivo de Consulta" Style="{StaticResource SectionTitleStyle}" />
                    </StackLayout>
                    <Label Text="{Binding Cita.MotivoConsulta}" 
                           FontSize="12" 
                           TextColor="{StaticResource TextDark}"
                           LineBreakMode="WordWrap" />
                </StackLayout>
            </Frame>

            <!-- TRIAJE COMPACTO -->
            <Frame Style="{StaticResource MedicalCardStyle}"
                   IsVisible="{Binding Cita.TieneTriaje}">
                <StackLayout Spacing="10">
                    <StackLayout Orientation="Horizontal" Spacing="6">
                        <Label Text="🚨" FontSize="16" />
                        <Label Text="Triaje" Style="{StaticResource SectionTitleStyle}" />
                        <Frame BackgroundColor="{StaticResource MedicalRed}" 
                               CornerRadius="8" 
                               Padding="6,2"
                               HasShadow="False">
                            <Label Text="{Binding Cita.NivelUrgencia}" 
                                   FontSize="10" 
                                   FontAttributes="Bold"
                                   TextColor="White" />
                        </Frame>
                    </StackLayout>

                    <!-- Signos vitales en grid compacto -->
                    <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" 
                          RowSpacing="6" ColumnSpacing="6">

                        <Frame Grid.Row="0" Grid.Column="0" 
                               BackgroundColor="#FFFBEB" CornerRadius="6" 
                               HasShadow="False" Padding="8">
                            <StackLayout Spacing="2">
                                <Label Text="🌡️ Temp." Style="{StaticResource DataLabelStyle}" />
                                <Label Text="{Binding Cita.Temperatura, StringFormat='{0}°C'}" 
                                       Style="{StaticResource DataValueStyle}" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="0" Grid.Column="1" 
                               BackgroundColor="#FFFBEB" CornerRadius="6" 
                               HasShadow="False" Padding="8">
                            <StackLayout Spacing="2">
                                <Label Text="💓 Presión" Style="{StaticResource DataLabelStyle}" />
                                <Label Text="{Binding Cita.PresionArterial}" 
                                       Style="{StaticResource DataValueStyle}" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="0" Grid.Column="2" 
                               BackgroundColor="#FFFBEB" CornerRadius="6" 
                               HasShadow="False" Padding="8">
                            <StackLayout Spacing="2">
                                <Label Text="💗 FC" Style="{StaticResource DataLabelStyle}" />
                                <Label Text="{Binding Cita.FrecuenciaCardiaca, StringFormat='{0}'}" 
                                       Style="{StaticResource DataValueStyle}" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="1" Grid.Column="0" 
                               BackgroundColor="#FFFBEB" CornerRadius="6" 
                               HasShadow="False" Padding="8">
                            <StackLayout Spacing="2">
                                <Label Text="⚖️ Peso" Style="{StaticResource DataLabelStyle}" />
                                <Label Text="{Binding Cita.Peso, StringFormat='{0} kg'}" 
                                       Style="{StaticResource DataValueStyle}" />
                            </StackLayout>
                        </Frame>

                        <Frame Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" 
                               BackgroundColor="#FFFBEB" CornerRadius="6" 
                               HasShadow="False" Padding="8">
                            <StackLayout Spacing="2">
                                <Label Text="📏 Estatura" Style="{StaticResource DataLabelStyle}" />
                                <Label Text="{Binding Cita.Altura, StringFormat='{0} cm'}" 
                                       Style="{StaticResource DataValueStyle}" />
                            </StackLayout>
                        </Frame>
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- CONSULTA COMPACTA -->
            <Frame Style="{StaticResource MedicalCardStyle}"
                   IsVisible="{Binding Cita.TieneConsulta}">
                <StackLayout Spacing="8">
                    <StackLayout Orientation="Horizontal" Spacing="6">
                        <Label Text="🩺" FontSize="16" />
                        <Label Text="Consulta Médica" Style="{StaticResource SectionTitleStyle}" />
                    </StackLayout>

                    <!-- Cada sección en una línea compacta -->
                    <StackLayout Spacing="6"
                                 IsVisible="{Binding Cita.Sintomatologia, Converter={StaticResource IsNotNullConverter}}">
                        <Label Text="🔍 Síntomas:" Style="{StaticResource DataLabelStyle}" />
                        <Label Text="{Binding Cita.Sintomatologia}" 
                               FontSize="11" TextColor="{StaticResource TextDark}" 
                               LineBreakMode="WordWrap" />
                    </StackLayout>

                    <StackLayout Spacing="6"
                                 IsVisible="{Binding Cita.Diagnostico, Converter={StaticResource IsNotNullConverter}}">
                        <Label Text="🎯 Diagnóstico:" Style="{StaticResource DataLabelStyle}" />
                        <Label Text="{Binding Cita.Diagnostico}" 
                               FontSize="11" FontAttributes="Bold" TextColor="{StaticResource MedicalRed}" 
                               LineBreakMode="WordWrap" />
                    </StackLayout>

                    <StackLayout Spacing="6"
                                 IsVisible="{Binding Cita.Tratamiento, Converter={StaticResource IsNotNullConverter}}">
                        <Label Text="💊 Tratamiento:" Style="{StaticResource DataLabelStyle}" />
                        <Label Text="{Binding Cita.Tratamiento}" 
                               FontSize="11" TextColor="{StaticResource TextDark}" 
                               LineBreakMode="WordWrap" />
                    </StackLayout>

                    <StackLayout Spacing="6"
                                 IsVisible="{Binding Cita.ConsultaObservaciones, Converter={StaticResource IsNotNullConverter}}">
                        <Label Text="📖 Observaciones:" Style="{StaticResource DataLabelStyle}" />
                        <Label Text="{Binding Cita.ConsultaObservaciones}" 
                               FontSize="11" TextColor="{StaticResource TextMedium}" 
                               LineBreakMode="WordWrap" />
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- BOTONES COMPACTOS -->
            <Frame Style="{StaticResource MedicalCardStyle}">
                <StackLayout Spacing="8">
                    <Label Text="🔧 Acciones" Style="{StaticResource SectionTitleStyle}" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button Grid.Column="0"
                                Text="❌ Cerrar"
                                BackgroundColor="{StaticResource TextMedium}"
                                TextColor="White"
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding CerrarModalCommand}" />

                        <Button Grid.Column="1"
                                Text="🖨️ PDF"
                                BackgroundColor="{StaticResource MedicalBlue}"
                                TextColor="White"
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding ImprimirCitaCommand}" />

                        <Button Grid.Column="2"
                                Text="📤 Compartir"
                                BackgroundColor="{StaticResource MedicalTeal}"
                                TextColor="White"
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding CompartirExpedienteCommand}" />
                    </Grid>
                </StackLayout>
            </Frame>

        </StackLayout>
    </ScrollView>
</ContentPage>